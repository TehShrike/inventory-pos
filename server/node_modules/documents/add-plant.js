var db = require('db')
var reducer = require('../../../reducers/add-plant')
var createStore = require('redux').createStore

module.exports = function saveAddPlantDocument(userId, addPlantDocument, cb) {
	const store = createStore(reducer, addPlantDocument)

	db.promise.user.load(userId).then(user => {
		store.dispatch({
			type: 'ADD_USER',
			payload: user.userId
		})

		db.promise.account.load(user.accountId).then(account => {
			store.dispatch({
				type: 'ADD_ACCOUNT',
				payload: account.accountId
			})
			store.dispatch({
				type: 'TAG_SCOPE',
				payload: account.defaultTagScope
			})
			db.plant.saveAddPlantDocument(store.getState(), cb)
		})
	})
}
