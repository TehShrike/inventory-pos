var db = require('db')
// var reducer = require('../../../reducers/plant-growth-phase-change-reducer')

module.exports = function savePlantGrowthPhaseChange({userId, growthPhaseChangeDocument}, cb) {
	db.promise.account.loadByUserId(userId).then(account => {

		return db.promise.plant.loadByTag({
			tagNumber: growthPhaseChangeDocument.plantTags,
			accountId: account.accountId,
			tagScope: account.defaultTagScope
		}).then(plants => {
			const date = new Date()

			const newRows = plants.map(plant => {
				return {
					plantId: plant.plantId,
					fromGrowthPhase: plant.fromGrowthPhase,
					toGrowthPhase: plant.toGrowthPhase,
					date
				}
			})

			db.plantGrowthPhaseChange.insertRows(newRows, err => {
				if (err) {
					cb(err)
				} else {
					cb(null, newRows)
				}
			})
		})
	}).catch(cb)
}
